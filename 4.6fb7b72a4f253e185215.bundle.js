(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1707:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var jellyschema=__webpack_require__(1708),cloneDeep=__webpack_require__(119),isEqual=__webpack_require__(355),merge=__webpack_require__(712),omit=__webpack_require__(247),React=__webpack_require__(0),Form_1=__webpack_require__(714),formulas_1=__webpack_require__(1712),computeFormSchemas=function(jellySchema,uiSchema){var computed=jellyschema.generateJsonAndUiSchema(jellySchema);return{schema:computed.jsonSchema,uiSchema:merge({},computed.uiSchema,uiSchema)}},JellyForm=function(_super){function JellyForm(props){var _this=_super.call(this,props)||this;_this.onChange=function(changeData){var formData=changeData.formData,schema=_this.state.schema,data=cloneDeep(formData),evaluate=formulas_1.runFormulas(schema,data),startingState=formulas_1.defaultValueForSchema(schema),result=merge(startingState,formData,evaluate);_this.setState({value:result}),_this.props.onFormChange&&_this.props.onFormChange(__assign({},changeData,{formData:result}))};var _a=computeFormSchemas(props.schema,props.uiSchema),schema=_a.schema,uiSchema=_a.uiSchema;return _this.state={value:props.value||formulas_1.defaultValueForSchema(schema),schema:schema,uiSchema:uiSchema},_this}return __extends(JellyForm,_super),JellyForm.prototype.componentWillReceiveProps=function(nextProps){if(isEqual(this.props.value,nextProps.value)||this.setState({value:formulas_1.runFormulas(this.state.schema,nextProps.value)}),!isEqual(this.props.schema,nextProps.schema)||!isEqual(this.props.uiSchema,nextProps.uiSchema)){var _a=computeFormSchemas(nextProps.schema,nextProps.uiSchema),schema=_a.schema,uiSchema=_a.uiSchema;this.setState({schema:schema,uiSchema:uiSchema})}},JellyForm.prototype.render=function(){var _a=this.state,value=_a.value,schema=_a.schema,uiSchema=_a.uiSchema,options=omit(this.props,["value","schema","uiSchema","onFormChange"]);return React.createElement(Form_1.default,__assign({value:value,schema:schema,uiSchema:uiSchema,onFormChange:this.onChange},options))},JellyForm}(React.Component);exports.default=JellyForm},1711:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1711},1712:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var temen=__webpack_require__(1709),cloneDeep=__webpack_require__(119),get=__webpack_require__(120),isPlainObject=__webpack_require__(185),merge=__webpack_require__(712),set=__webpack_require__(1715);exports.runFormulas=function(schema,value){var evaluate,data=cloneDeep(value);replaceDataWithFormulaContent(schema,data);try{evaluate=temen.evaluate(data)}catch(e){console.error("Caught error when evaluating formulas",e),evaluate=value}var startingState=defaultValueForSchema(schema);return merge(startingState,value,evaluate)};var defaultValueForSchema=function(schema){return"array"===schema.type?[]:{}};exports.defaultValueForSchema=defaultValueForSchema;var replaceDataWithFormulaContent=function(schema,data){getFormulaKeys(schema).map(function(path){return{formula:get(schema,path),path:path.replace(/properties\./g,"")}}).forEach(function(formula){var fullPath=formula.path,formulaText=formula.formula;if(fullPath.includes(".items.")){var pathFragments=fullPath.split(".items.");replaceArrayWithFormulaContent(pathFragments,data,formulaText)}else set(data,fullPath,formulaText)})},replaceArrayWithFormulaContent=function(pathFragments,data,formulaText){var firstFragment=pathFragments[0],lastFragment=pathFragments[1],array=data[firstFragment]||[];if(pathFragments.length>2){var subFragments_1=pathFragments.slice(1,pathFragments.length);array.forEach(function(item){replaceArrayWithFormulaContent(subFragments_1,item,formulaText)})}else array.forEach(function(item){set(item,lastFragment,formulaText)})},getFormulaKeys=function(obj,prefix){void 0===prefix&&(prefix="");var keys=Object.keys(obj);return prefix=prefix?prefix+".":"",keys.reduce(function(result,key){return isPlainObject(obj[key])?result=result.concat(getFormulaKeys(obj[key],prefix+key)):"$$formula"===key&&result.push(prefix+key),result},[])}},1714:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1714}}]);
//# sourceMappingURL=4.6fb7b72a4f253e185215.bundle.js.map